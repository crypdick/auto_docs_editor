[project]
name = "auto_docs_editor"
version = "0.1.0"
description = "AutoDocsEditor makes documentation conform to the Google Docs Style Guide"
readme = "README.md"
requires-python = ">=3.12"
# Do not edit dependencies manually. Use `uv add` or `uv remove` to manage dependencies.
dependencies = [
    "jupytext>=1.18.1",
    "langchain>=1.1.0",
    "langchain-classic>=1.0.0",
    "langchain-community>=0.4.1",
    "langchain-openai>=1.1.0",
    "langfuse>=3.10.1",
    "loguru>=0.7.3",
    "nbconvert>=7.16.6",
    "openai>=2.8.1",
    "pydantic>=2.12.4",
    "python-dotenv>=1.2.1",
    "rich>=14.2.0",
    "textual>=6.6.0",
]

[project.scripts]
auto-docs-edit = "auto_docs_editor.cli:main"
auto-docs-tui = "auto_docs_editor.tui:run"

[project.optional-dependencies]
dev = [
    "ruff>=0.1.0",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.ruff]
line-length = 100
exclude = [
    "archive/**",
    "incidents/**",
]

[tool.ruff.lint]
# Enable commonly useful lint rule sets.
select = ["E", "F", "I", "UP", "N", "B"]
ignore = ["E501"]

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["F841"]

[dependency-groups]
dev = [
    "pytest>=9.0.2",
    "pytest-asyncio>=1.3.0",
    "pytest-cov>=7.0.0",
    "pytest-mock>=3.15.1",
    "pytest-timeout>=2.4.0",
    "pytest-xdist>=3.8.0",
]

[tool.pytest.ini_options]
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "function"
testpaths = ["tests"]
pythonpath = ["."]

# Enable concurrent testing with pytest-xdist
# Use -n auto to automatically detect number of CPUs
# Or override with: uv run pytest -n <number>
# -q hides passing tests (minimizes output) but shows full details for failures
# show top 5 slowest tests that are > 1.0 seconds long
addopts = "--no-header -n auto -q --durations=5 --durations-min=1.0 --failed-first"

# Fail tests that exceed a reasonable execution time to catch hangs early.
timeout = 5
timeout_method = "thread"

markers = [
    "serial: mark test to run serially (not in parallel)",
]

# Silence noisy third-party warnings during the test run.
filterwarnings = [
    # Textual occasionally leaks unraisable exceptions on shutdown which are
    # harmless for our test environment.
    "ignore:Exception ignored in.*MessagePump.*:pytest.PytestUnraisableExceptionWarning",
    # Textual's MessagePump._process_messages coroutine may not be awaited during test shutdown
    # This is harmless and occurs when the app shuts down before all async tasks complete.
    "ignore:.*MessagePump.*:RuntimeWarning",
    # Resource warnings for temporary directories and event loops that are closed via finalizers in tests.
    "ignore:Implicitly cleaning up.*:ResourceWarning",
    "ignore:unclosed event loop.*:ResourceWarning",
]
